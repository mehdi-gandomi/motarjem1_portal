/*
 * FilePondPluginFileEncode 2.0.0
 * Licensed under MIT, https://opensource.org/licenses/MIT
 * Please visit https://pqina.nl/filepond for details.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.FilePondPluginFileEncode=t()}(this,function(){"use strict";var r=function(){self.onmessage=function(t){e(t.data.message,function(e){self.postMessage({id:t.data.id,message:e})})};var e=function(e,t){var i=e.file,n=new FileReader;n.onloadend=function(){t(n.result.replace("data:","").replace(/^.+,/,""))},n.readAsDataURL(i)}},e=function(e){var t=e.addFilter,i=e.utils,n=i.Type,a=i.createWorker,d=i.createRoute,o=i.isFile,u=[];return t("SHOULD_PREPARE_OUTPUT",function(){return new Promise(function(e){e(!0)})}),t("COMPLETE_PREPARE_OUTPUT",function(i,e){var n=e.item;return new Promise(function(t){o(i)?(u[n.id]={metadata:n.getMetadata(),imagedata:null},a(r).post({file:i},function(e){u[n.id].imagedata=e,t(i)})):t(i)})}),t("CREATE_VIEW",function(e){var t=e.is,i=e.view,r=e.query;t("file-wrapper")&&r("GET_ALLOW_FILE_ENCODE")&&i.registerWriter(d({DID_PREPARE_OUTPUT:function(e){var t=e.root,i=e.action;if(!r("IS_ASYNC")){var n=r("GET_ITEM",i.id),a=u[n.id],d=a.metadata,o=a.imagedata;t.ref.data.value=JSON.stringify({id:n.id,name:n.file.name,type:n.file.type,size:n.file.size,metadata:d,data:o}),u[n.id].imagedata=null}}}))}),{options:{allowFileEncode:[!0,n.BOOLEAN]}}};return"undefined"!=typeof window&&void 0!==window.document&&document&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:e})),e});