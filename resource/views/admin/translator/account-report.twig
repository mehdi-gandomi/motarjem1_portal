{% extends 'admin/layout/translator.twig' %}
{% block content %}
    <main class="main" style="min-height:550px">
        <div class="card">
            <div class="card-body container">
                <h4 class="text-center mt-3">گزارش حساب شما</h4>
                <div class="info-cards ">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="info-card is--revenue">
                                <div class="info-card__icon bg-primary">
                                    <img alt="revenue" src="/public/images/icon/income.svg"/>
                                </div>
                                <div class="info-card__content">
                                    <div class="info-card__content__title">
                                        میزان درآمد شما تا کنون
                                    </div>
                                    <div class="info-card__content__value">
                                        {{ revenue ? revenue : 0 }}
                                        <span class="f-1rem ml-2">تومان</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="info-card is--balance">
                                <div class="info-card__icon bg-purple">
                                    <img alt="" src="/public/images/icon/wallet.svg"/>
                                </div>
                                <div class="info-card__content">
                                    <div class="info-card__content__title">
                                        میزان اعتبار حساب شما
                                    </div>
                                    <div class="info-card__content__value">
                                        {{ account_balance ? account_balance : 0 }}
                                        <span class="f-1rem ml-1">تومان</span>
                                    </div>
                                    <div class="info-card__content__link">
                                        <a href="/account/checkout">درخواست پرداخت وجه</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="info-card is--checkout">
                                <div class="info-card__icon bg-success">
                                    <img alt="" src="/public/images/icon/atm.svg"/>
                                </div>
                                <div class="info-card__content">
                                    <div class="info-card__content__title">
                                        میزان برداشتی شما تا کنون
                                    </div>
                                    <div class="info-card__content__value">
                                        {{ total_checkouts ? total_checkouts : 0 }}
                                        <span class="f-1rem">تومان</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <h4 class="text-center mt-5">پروژه های تکمیل شده توسط شما</h4>
                <div class="row">
                    <div class="col-12">
                        <table class="table is--responsive" id="orders-table">
                            <thead>
                                <tr>
                                    <th class="bg-teal-dark" scope="col">#</th>
                                    <th class="bg-teal-dark" scope="col">زبان ترجمه</th>
                                    <th class="bg-teal-dark" scope="col">کیفیت ترجمه</th>
                                    <th class="bg-teal-dark" scope="col">هزینه ترجمه</th>
                                    <th class="bg-teal-dark" scope="col">سهم شما</th>
                                    <th class="bg-teal-dark" scope="col">جزییات</th>
                                </tr>
                            </thead>
                            <tbody id="user-orders">
                                {% if completed_orders %}
                                    {% for order in completed_orders %}
                                        {%
              set page_number = order.word_numbers / 250 | round(0,'ceil') %}
                                        <tr>
                                            <td data-label="شماره سفارش">
                                                {{ order.order_number }}</td>
                                            <td data-label="زبان ترجمه">
                                                {{
                    order.translation_lang == "1"
                      ? "انگلیسی به فارسی"
                      : "فارسی به انگلیسی"
                  }}
                                            </td>
                                            <td data-label="کیفیت ترجمه">
                                                {{ order.translation_quality == "5" ? "نقره ای" : "طلایی" }}
                                            </td>
                                            <td data-label="هزینه ترجمه">
                                                {{ order.order_price |number_format }}
                                                تومان</td>
                                            <td data-label="سهم شما">
                                                {{ ((order.order_price*70)/100 | round(0,'ceil')) | number_format }}
                                            </td>
                                            <td class="order-more-info" data-label="جزییات">
                                                <a onclick="showOrderInfo('{{order.order_number}}')">
                                                    <svg height="23px" viewBox="0 0 50 80" width="13px" xml:space="preserve">
                                                        <polyline fill="none" points="45.63,75.8 0.375,38.087 45.63,0.375 " stroke-linecap="round" stroke-linejoin="round" stroke-width="10" stroke="#a9a9a9"></polyline>
                                                    </svg>
                                                </a>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                    {% else %}
                                    <tr>
                                        <td colspan="6">
                                            <h5 class="text-center">
                                                شما تاکنون پروژه ای را به اتمام نرسانده اید !
                                            </h5>
                                        </td>
                                    </tr>
                                {% endif %}
                            </tbody>
                        </table>
                        {% include 'admin/includes/pagination.twig' with { 'count' :
          completed_orders_count, 'page_prefix':'order_', 'current_page' :
          completed_orders_current_page, 'base_path' :
          '/translator/account-report', 'offset' : 10, 'visible_numbers' : 3 }
          %}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-5 row">
                        <div class="col-12">
                            <h4 class="text-center mt-4">درخواست های برداشت شما</h4>
                        </div>
                        <div class="col-12">
                            <table class="table is--responsive" id="orders-table">
                                <thead>
                                    <tr>
                                        <th class="bg-teal-dark" scope="col">#</th>
                                        <th class="bg-teal-dark" scope="col">مبلغ درخواستی</th>
                                        <th class="bg-teal-dark" scope="col">تاریخ درخواست</th>
                                    </tr>
                                </thead>
                                <tbody id="user-orders">
                                    {% if checkoutـrequest_logs %}
                                        {% for log in
                checkoutـrequest_logs %}
                                            <tr>
                                                <td data-label="ردیف">
                                                    {{ log.id }}</td>
                                                <td data-label="مبلغ درخواستی">
                                                    {{ log.amount }}</td>
                                                <td data-label="تاریخ درخواست">
                                                    {{ log.request_date_persian }}
                                                </td>
                                            </tr>
                                        {% endfor %}
                                        {% else %}
                                        <tr>
                                            <td colspan="5">
                                                <h5 class="text-center">
                                                    تاکنون درخواستی نداشته اید !
                                                </h5>
                                            </td>
                                        </tr>
                                    {% endif %}
                                </tbody>
                            </table>
                            {% include 'admin/includes/pagination.twig' with { 'count' :
            checkoutـrequest_logs_count, 'page_prefix':'checkout_request_', 'current_page' :
            checkoutـrequest_logs_current_page, 'base_path' : '/translator/account-report',
            'offset' : 10, 'visible_numbers' : 3 } %}
                        </div>
                    </div>
                    <div class="col-md-7 row">
                        <div class="col-12">
                            <h4 class="text-center mt-4">برداشتی های شما</h4>
                        </div>
                        <div class="col-12">
                            <table class="table is--responsive" id="orders-table">
                                <thead>
                                    <tr>
                                        <th class="bg-teal-dark" scope="col">#</th>
                                        <th class="bg-teal-dark" scope="col">مبلغ پرداخت شده</th>
                                        <th class="bg-teal-dark" scope="col">تاریخ درخواست</th>
                                        <th class="bg-teal-dark" scope="col">تاریخ واریز</th>
                                        <th class="bg-teal-dark" scope="col">شماره پیگیری</th>
                                    </tr>
                                </thead>
                                <tbody id="user-orders">
                                    {% if checkout_logs %}
                                        {% for log in checkout_logs %}
                                            <tr>
                                                <td data-label="ردیف">
                                                    {{ log.id }}</td>
                                                <td data-label="مبلغ پرداخت شده">
                                                    {{ log.amount }}</td>
                                                <td data-label="تاریخ درخواست">
                                                    {{ log.request_date_persian }}
                                                </td>
                                                <td data-label="تاریخ واریز">
                                                    {{ log.settle_date_persian }}
                                                </td>
                                                <td data-label="شماره پیگیری">
                                                    {{ log.refer_code }}</td>
                                            </tr>
                                        {% endfor %}
                                        {% else %}
                                        <tr>
                                            <td colspan="5">
                                                <h5 class="text-center">
                                                    تاکنون برداشتی از حسابتان نداشته اید !
                                                </h5>
                                            </td>
                                        </tr>
                                    {% endif %}
                                </tbody>
                            </table>
                            {% include 'admin/includes/pagination.twig' with { 'count' :
            checkouts_count, 'page_prefix':'checkout_', 'current_page' :
            checkouts_current_page, 'base_path' : '/translator/account-report',
            'offset' : 10, 'visible_numbers' : 3 } %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <!-- Modal -->
            <div aria-hidden="true" aria-labelledby="orderDetailsModalLabel" class="modal fade" id="orderDetailsModal" role="dialog" tabindex="-1">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header justify-content-center">
                            <h5 class="modal-title" id="orderDetailsModalLabel">اطلاعات سفارش</h5>
                            {# <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                    <span aria-hidden="true">&times;</span>
                                                </button> #}
                        </div>
                        <div class="modal-body" id="orderDetailsWrap" style="padding:2rem"></div>
                        <div class="modal-footer justify-content-start">
                            <button class="btn btn-secondary" data-dismiss="modal" type="button">بستن</button>
                        </div>
                    </div>
                </div>
            </div>
{% endblock %}

{% block script_below %}
<script>
function showOrderInfo(orderNumber){
    $.get("/translator/order/info/"+orderNumber,function(data,status){
        let output="<div class='order-details row'>";
        let translationLang=data.translation_lang=="1" ? "انگلیسی به فارسی":"فارسی به انگلیسی";
        let translationQuality=data.translation_quality == "5" ? "نقره ای":"طلایی";
        let translationKind=data.translation_kind == '1' ? "عمومی":"تخصصی";
        let deliveryType;
        if(data.delivery_type=="1"){
            deliveryType="معمولی";
        }else if(data.delivery_type=="2"){
            deliveryType="نیمه فوری";
        }else{
            deliveryType="فوری";
        }
        output+="<div class='order-details__detail col-md-3'><div class='order-details__detail__label'>شماره سفارش</div><div class='order-details__detail__value'>"+data.order_number+"</div></div>";
        output+="<div class='order-details__detail col-md-3'><div class='order-details__detail__label'>تعداد صفحات</div><div class='order-details__detail__value'>"+Math.ceil(data.word_numbers/250)+"</div></div>";
        output+="<div class='order-details__detail col-md-3'><div class='order-details__detail__label'>زبان ترجمه</div><div class='order-details__detail__value'>"+translationLang+"</div></div>";
        output+="<div class='order-details__detail col-md-3'><div class='order-details__detail__label'>کیفیت ترجمه</div><div class='order-details__detail__value'>"+translationQuality+"</div></div>";
        output+="<div class='order-details__detail col-md-3'><div class='order-details__detail__label'>نوع ترجمه</div><div class='order-details__detail__value'>"+translationKind+"</div></div>";
        output+="<div class='order-details__detail col-md-4'><div class='order-details__detail__label'>رشته دانشگاهی</div><div class='order-details__detail__value'>"+data.study_field+"</div></div>";
        output+="<div class='order-details__detail col-md-5'><div class='order-details__detail__label'>زمان تحویل</div><div class='order-details__detail__value'>"+deliveryType+"</div></div>";
        output+="<div class='order-details__detail col-md-3'><div class='order-details__detail__label'>زمان تخمینی برحسب روز</div><div class='order-details__detail__value'>"+data.delivery_days+"</div></div>";
        output+="<div class='order-details__detail col-md-4'><div class='order-details__detail__label'>نام سفارش دهنده</div><div class='order-details__detail__value'>"+data.orderer_fname+" "+data.orderer_lname+"</div></div>";
        output+="<div class='order-details__detail col-md-5'><div class='order-details__detail__label'>ایمیل سفارش دهنده</div><div class='order-details__detail__value'>"+data.email+"</div></div>";
        output+="<div class='order-details__detail col-md-4'><div class='order-details__detail__label'>تاریخ ثبت سفارش</div><div class='order-details__detail__value'>"+data.order_date_persian+"</div></div>";
        output+="<div class='order-details__detail col-md-3'><div class='order-details__detail__label'>قیمت کل سفارش</div><div class='order-details__detail__value'>"+parseInt(data.order_price).toLocaleString("us")+"</div></div>";
        output+="<div class='order-details__detail col-md-5'><div class='order-details__detail__label'>سهم شما از این سفارش</div><div class='order-details__detail__value'>"+Math.ceil((data.order_price*70)/100).toLocaleString("us")+"</div></div>";
        if(data.description){
            output+="<div class='order-details__detail col-md-8'><div class='order-details__detail__label'>توضیحات</div><div class='order-details__detail__value'>"+data.description+"</div></div>";
        }
        if(data.order_files){
            let files=data.order_files.split(",");
            let filesHtml="";
            files.forEach(function(file){
                filesHtml+="<a style='display:block' href='/public/uploads/order/"+file+"' download='"+file+"'>"+file+"</a>"
            })
            output+="<div class='order-details__detail col-md-4'><div class='order-details__detail__label'>فایل ها</div><div class='order-details__detail__value'>"+filesHtml+"</div></div>";
        }
        output+="</div>";
        $("#orderDetailsWrap").html(output);
        $("#orderDetailsModal").modal("show");
    });
    // Swal.fire({
    //     title: '<strong>HTML <u>example</u></strong>',
    //     type: 'info',
    //     html:
    //       'You can use <b>bold text</b>, ' +
    //       '<a href="//github.com">links</a> ' +
    //       'and other HTML tags',
    //     showCloseButton: true,
    //     showCancelButton: true,
    //     focusConfirm: false,
    //     confirmButtonText:
    //       '<i class="fa fa-thumbs-up"></i> Great!',
    //     confirmButtonAriaLabel: 'Thumbs up, great!',
    //     cancelButtonText:
    //       '<i class="fa fa-thumbs-down"></i>',
    //     cancelButtonAriaLabel: 'Thumbs down',
    //   })
  }
</script>
{% endblock %}